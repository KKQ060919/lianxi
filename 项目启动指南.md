# 🛒 智能商城系统 - 项目启动指南

## 📋 项目概述

这是一个基于Django + Vue + RAG + Agents技术栈的智能商城系统，具有以下特性：

- **商品管理**: 商品展示、分类筛选、热门商品推荐
- **用户行为分析**: 实时记录用户浏览行为，Redis缓存最近浏览记录
- **RAG问答系统**: 基于商品知识库的智能问答
- **Agents推荐系统**: 基于用户行为的个性化商品推荐
- **Redis缓存**: 高性能数据缓存和用户行为存储

## 🏗️ 技术架构

### 后端技术栈
- **Django 5.1.7**: Web框架
- **Django REST Framework**: API开发
- **MySQL**: 主数据库
- **Redis**: 缓存和用户行为存储
- **LangChain**: RAG和Agents框架
- **ChromaDB**: 向量数据库
- **通义千问**: 大语言模型

### 前端技术栈
- **Vue 3**: 前端框架
- **Vue Router**: 路由管理
- **Axios**: HTTP客户端
- **Vite**: 构建工具

## 🚀 快速启动

### 1. 环境准备

#### 系统要求
- Python 3.8+
- Node.js 16+
- MySQL 5.7+
- Redis 6.0+

#### 安装依赖
```bash
# 后端依赖
pip install -r requirements.txt

# 前端依赖
cd day12_vue
npm install
```

### 2. 数据库配置

#### MySQL配置
1. 创建数据库:
```sql
CREATE DATABASE 0819 CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. 创建外部知识库数据库（可选）:
```sql
CREATE DATABASE book_rag_knowledge_base CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

#### Redis配置
确保Redis服务运行在默认端口6379

### 3. Django配置

#### 数据库迁移
```bash
# 创建迁移文件
python manage.py makemigrations

# 执行迁移
python manage.py migrate
```

#### 生成模拟数据
```bash
# 生成商品、用户画像、知识库和行为数据
python manage.py generate_mock_data --products 15 --users 10 --knowledge 50 --behaviors 100
```

#### 初始化Redis缓存
```bash
# 预热热门商品到Redis
python manage.py init_redis
```

### 4. 启动服务

#### 启动Django后端
```bash
python manage.py runserver 8000
```

#### 启动Vue前端
```bash
cd day12_vue
npm run dev
```

## 📱 功能模块

### 1. 商品模块 (`/api/product/`)
- `GET /api/product/list/` - 商品列表（支持分页、搜索、筛选）
- `GET /api/product/detail/<product_id>/` - 商品详情
- `GET /api/product/hot/` - 热门商品
- `GET /api/product/categories/` - 商品分类
- `GET /api/product/brands/` - 商品品牌

### 2. 用户行为模块 (`/api/users/`)
- `POST /api/users/behavior/` - 记录用户行为
- `GET /api/users/recent-views/<user_id>/` - 用户最近浏览
- `GET /api/users/behavior-stats/<user_id>/` - 用户行为统计

### 3. RAG问答模块 (`/api/rag/`)
- `POST /api/rag/question/` - 智能问答
- `POST /api/rag/initialize/` - 系统初始化
- `GET /api/rag/search/` - 知识库搜索
- `GET /api/rag/knowledge/` - 商品知识管理
- `GET /api/rag/similar-questions/` - 相似问题推荐

### 4. Agents推荐模块 (`/api/agents/`)
- `POST /api/agents/recommend/` - 智能推荐
- `GET/POST /api/agents/profile/` - 用户画像管理

## 🎯 前端页面

- **首页** (`/`) - 系统介绍和导航
- **热门商品** (`/hot-products`) - 热门商品展示
- **商品页面** (`/products`) - 商品列表和搜索
- **智能问答** (`/rag-chat`) - RAG问答系统
- **智能推荐** (`/agents-chat`) - Agents推荐系统

## 🔧 配置说明

### Redis配置
- 数据库0: 商品缓存
- 数据库1: 用户行为缓存

### API密钥配置
在相应文件中配置：
- 通义千问API密钥
- DashScope API密钥

### 向量数据库
- 商品知识: `./chroma_product_knowledge`
- 外部知识库: `./chroma_mysql_v1`

## 🧪 测试

### API接口测试
```bash
python test_apis.py
```

### 手动测试流程
1. 访问前端页面 `http://localhost:5173`
2. 浏览热门商品，点击查看详情
3. 在商品页面搜索和筛选
4. 使用RAG问答功能
5. 配置用户偏好并获取推荐

## 📊 数据流程

### 用户行为记录流程
1. 用户浏览商品 → 前端记录行为
2. 行为数据存储到MySQL和Redis
3. Redis保存最近10条浏览记录
4. 用于推荐系统分析

### RAG问答流程
1. 用户提问 → 向量化查询
2. 检索相关知识 → LLM生成回答
3. 返回答案和来源文档

### Agents推荐流程
1. 分析用户画像和行为历史
2. 协同过滤 + 内容过滤
3. 结合商品热度生成推荐
4. 提供详细推荐理由

## 🔍 故障排除

### 常见问题

1. **Django启动失败**
   - 检查数据库连接配置
   - 确保迁移文件已执行

2. **Redis连接失败**
   - 确认Redis服务运行状态
   - 检查端口配置

3. **RAG系统初始化失败**
   - 检查API密钥配置
   - 确认网络连接正常

4. **前端页面空白**
   - 检查后端API接口状态
   - 查看浏览器控制台错误

### 日志查看
- Django日志: 控制台输出
- Redis日志: Redis服务日志
- 前端日志: 浏览器开发者工具

## 📈 性能优化

### Redis缓存策略
- 热门商品: 30分钟过期
- 商品详情: 1小时过期
- 用户行为: 30天过期

### 数据库优化
- 为用户行为添加索引
- 商品查询使用分页
- 定期清理过期数据

## 🔒 安全考虑

- API接口参数验证
- 用户输入内容过滤
- 数据库查询防注入
- Redis访问控制

## 📝 开发注意事项

1. **代码规范**: 遵循PEP8和Vue风格指南
2. **错误处理**: 完善的异常捕获和用户提示
3. **性能监控**: 关注API响应时间和缓存命中率
4. **数据一致性**: 确保MySQL和Redis数据同步

## 🎉 项目特色

### 技术创新点
1. **混合推荐系统**: 结合协同过滤、内容过滤和LLM决策
2. **RAG增强问答**: 基于商品知识库的准确回答
3. **实时行为分析**: Redis ZSET实现高性能用户行为存储
4. **智能Agent架构**: 工具链式推荐决策流程

### 业务价值
1. **个性化体验**: 基于用户行为的精准推荐
2. **智能客服**: 自动回答商品相关问题
3. **数据驱动**: 实时用户行为分析和洞察
4. **技术前瞻**: 展示AI在电商场景的实际应用

---

🚀 **开始体验智能商城系统吧！**

如有问题，请查看日志或联系开发团队。

